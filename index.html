<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tecla Ultra Avan√ßada</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#fff9f0; color:#333;}
  header { text-align:center; padding:10px; background:#4b9cd3; color:white; border-radius:8px;}
  .container { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:14px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
  select, input[type="text"] { width:100%; padding:12px; margin-top:10px; font-size:18px; border:1px solid #ccc; border-radius:8px;}
  button { background:#4b9cd3; color:white; padding:12px 20px; font-size:18px; border:none; border-radius:8px; margin-top:10px; cursor:pointer;}
  .pictogramas { display:flex; flex-wrap:wrap; gap:10px; margin-top:20px;}
  .pictograma { flex:1 1 30%; background:#e1f0fb; padding:14px; font-size:16px; text-align:center; border-radius:8px; cursor:pointer; border:1px solid #aad;}
  .pictograma:hover { background:#cde9fa;}
  #saida, #alertas { margin-top:20px; font-size:20px; color:#222; padding:10px; background:#e6f7ff; border-radius:8px;}
  .alert { margin-top:10px; padding:10px; background:#ffcccc; border-radius:8px; font-weight:bold; color:#900;}
  .barra-versoes { display:flex; justify-content:space-around; margin-top:15px;}
  .barra { padding:10px; border-radius:8px; cursor:pointer; flex:1; text-align:center; margin:0 5px; color:white; font-weight:bold;}
  .free { background:#4caf50;}
  .intermediate { background:#ff9800;}
  .premium { background:#f44336;}
  .respiracao { margin-top:15px; font-size:18px; color:#007acc;}
  .iframe-versao { width:100%; height:300px; margin-top:15px; border:2px solid #4b9cd3; border-radius:8px; }
  canvas { margin-top:20px; border:1px solid #ccc; border-radius:8px; background:#f9f9f9; }
  ul { margin-top:15px; padding-left:0; list-style:none;}
  li { cursor:pointer; margin-bottom:5px; }
</style>
</head>
<body>
<header>
  <h1>üß† Tecla Ultra Avan√ßada</h1>
  <p>Hist√≥rico, gr√°ficos de alertas e predi√ß√£o preventiva para cuidadores e crian√ßas</p>
</header>

<div class="container">
  <label for="idioma">üåç Escolha o idioma:</label>
  <select id="idioma">
    <option value="pt-PT">Portugu√™s</option>
    <option value="en-US">English</option>
  </select>

  <label for="entrada">üí¨ Digite ou fale o que deseja:</label>
  <input type="text" id="entrada" placeholder="Ex: Quero brincar com o carrinho" />
  <button onclick="responder()">üîä Falar</button>
  <button onclick="falar()">üéôÔ∏è Falar com Tecla</button>

  <div class="pictogramas">
    <div class="pictograma" onclick="usarFrase('Quero comer')">üçΩÔ∏è Comer</div>
    <div class="pictograma" onclick="usarFrase('Preciso ir ao banheiro')">üöª Banheiro</div>
    <div class="pictograma" onclick="usarFrase('Estou feliz!')">üòä Feliz</div>
    <div class="pictograma" onclick="usarFrase('Quero brincar')">üß∏ Brincar</div>
    <div class="pictograma" onclick="usarFrase('Estou triste')">üò¢ Triste</div>
    <div class="pictograma" onclick="usarFrase('Estou com dor')">ü§ï Dor</div>
  </div>

  <div class="barra-versoes">
    <div class="barra free" onclick="abrirVersao('free')">Gratuita</div>
    <div class="barra intermediate" onclick="abrirVersao('intermediate')">Intermedi√°ria</div>
    <div class="barra premium" onclick="abrirVersao('premium')">Premium</div>
  </div>

  <iframe class="iframe-versao" id="iframeVersao"></iframe>
  <div id="saida"></div>
  <div id="alertas"></div>
  <div class="respiracao" id="respiracao"></div>
  <canvas id="graficoAlertas" width="750" height="250"></canvas>
  <ul id="historicoVersoes"></ul>
</div>

<script>
let versaoAtual = 'free';
let dadosLogs = [];

function responder() {
  const entrada = document.getElementById("entrada").value;
  const idioma = document.getElementById("idioma").value;
  let resposta = idioma==='pt-PT'
    ?"Tecla disse: '" + entrada + "'. Vamos entender com carinho e aten√ß√£o."
    :"Tecla said: '" + entrada + "'. Let's listen with care and love.";

  document.getElementById("saida").innerText=resposta;
  falarTexto(resposta, idioma);
  salvarFrase(entrada);
  processarEntrada(entrada);
  atualizarHistorico();
  atualizarGrafico();
}

function falarTexto(texto, idioma){
  const synth = window.speechSynthesis;
  const utterThis = new SpeechSynthesisUtterance(texto);
  utterThis.lang = idioma;
  synth.speak(utterThis);
}

function usarFrase(texto){
  document.getElementById("entrada").value = texto;
  responder();
}

function salvarFrase(frase){
  let key="frasesTecla_"+versaoAtual;
  let historico=JSON.parse(localStorage.getItem(key))||[];
  historico.push(frase);
  if(historico.length>10) historico.shift();
  localStorage.setItem(key, JSON.stringify(historico));
  dadosLogs.push({versao:versaoAtual, frase, alerta: frase.includes('triste')||frase.includes('dor')});
}

function falar(){
  const idioma=document.getElementById("idioma").value;
  const recognition=new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang=idioma;
  recognition.start();
  recognition.onresult=function(event){
    const textoFalado=event.results[0][0].transcript;
    document.getElementById("entrada").value=textoFalado;
    responder();
  }
}

function processarEntrada(entrada){
  const alertasDiv=document.getElementById("alertas");
  if(entrada.includes('triste')||entrada.includes('dor')){
    const div=document.createElement('div');
    div.className='alert';
    div.innerText='‚ö†Ô∏è Alerta: A crian√ßa pode precisar de aten√ß√£o!';
    alertasDiv.appendChild(div);
    iniciarRespiracao();
  }
  if(predicaoPreventiva()){
    const div=document.createElement('div');
    div.className='alert';
    div.innerText='‚ö†Ô∏è Poss√≠vel crise iminente detectada!';
    alertasDiv.appendChild(div);
    falarTexto("Aten√ß√£o! Poss√≠vel crise iminente.", document.getElementById("idioma").value);
    iniciarRespiracao();
  }
}

function predicaoPreventiva(){
  if(dadosLogs.length<3) return false;
  const ultimos=dadosLogs.slice(-3);
  return ultimos.filter(l=>l.alerta).length>=2;
}

function iniciarRespiracao(){
  const respDiv=document.getElementById("respiracao");
  let cont=0;
  respDiv.innerText="üåÄ Respire fundo...";
  const intervalo=setInterval(()=>{
    const fases=["Inspire... üå¨Ô∏è","Segure... ‚úã","Expire... üí®","Segure... ‚úã"];
    respDiv.innerText=fases[cont%4];
    cont++;
    if(cont>11){ clearInterval(intervalo); respDiv.innerText=""; }
  },2000);
}

function abrirVersao(versao){
  versaoAtual=versao;
  let iframe=document.getElementById("iframeVersao");
  let links={
    free:'https://example.com/tecla_free.html',
    intermediate:'https://example.com/tecla_intermediate.html',
    premium:'https://example.com/tecla_premium.html'
  };
  iframe.src=links[versao];
  alert('Vers√£o selecionada: '+versao);
  atualizarHistorico();
  atualizarGrafico();
}

function atualizarHistorico(){
  const lista=document.getElementById("historicoVersoes");
  lista.innerHTML="";
  ['free','intermediate','premium'].forEach(v=>{
    let key="frasesTecla_"+v;
    let hist=JSON.parse(localStorage.getItem(key))||[];
    if(hist.length>0){
      hist.forEach(f=>{
        const li=document.createElement("li");
        li.innerText=`[${v}] ${f}`;
        li.onclick=()=>{ document.getElementById("entrada").value=f; responder(); }
        lista.appendChild(li);
      });
    }
  });
}

function atualizarGrafico(){
  const canvas=document.getElementById("graficoAlertas");
  const ctx=canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);
  let counts={free:0,intermediate:0,premium:0};
  dadosLogs.forEach(l=>{ if(l.alerta) counts[l.versao]++; });
  const cores={free:'#4caf50',intermediate:'#ff9800',premium:'#f44336'};
  let i=0;
  for(let v in counts){
    ctx.fillStyle=cores[v];
    ctx.fillRect(50+i*200,canvas.height-30-counts[v]*20,50,counts[v]*20);
    ctx.fillStyle="#000";
    ctx.fillText(v,50+i*200,canvas.height-10);
    i++;
  }
}

window.onload=function(){
  atualizarHistorico();
  atualizarGrafico();
};
</script>
</body>
</html>

   
