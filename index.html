<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tecla Premium DinÃ¢mica</title>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<style>
body{font-family:Arial,sans-serif;background:#fff9f0;padding:20px;color:#333;}
.container{max-width:700px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
button{background:#4b9cd3;color:white;padding:10px 15px;margin-top:10px;border:none;border-radius:8px;cursor:pointer;}
.pictograma{display:inline-block;padding:10px;margin:5px;background:#e1f0fb;border-radius:8px;cursor:pointer;}
.barra{margin-top:15px;padding:10px;background:#f0f0f0;border-radius:8px;}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ§  Tecla Premium DinÃ¢mica</h1>

<h3>Login / Registro</h3>
<input type="text" id="username" placeholder="UsuÃ¡rio"/>
<input type="password" id="password" placeholder="Senha"/>
<button onclick="register()">Registrar</button>
<button onclick="login()">Login</button>

<hr>
<label>ğŸ’¬ Digite frase:</label>
<input type="text" id="entrada"/>
<button onclick="responder()">ğŸ”Š Falar</button>

<div class="pictogramas">
<div class="pictograma" onclick="usarFrase('Quero brincar')">ğŸ§¸ Brincar</div>
<div class="pictograma" onclick="usarFrase('Estou feliz')">ğŸ˜Š Feliz</div>
<div class="pictograma" onclick="usarFrase('Preciso ir ao banheiro')">ğŸš» Banheiro</div>
</div>

<h3>HistÃ³rico</h3>
<ul id="historico"></ul>

<h3>Barras de VersÃµes</h3>
<div class="barra" id="gratuita"><strong>Gratuita</strong><ul></ul></div>
<div class="barra" id="intermediaria"><strong>IntermediÃ¡ria</strong><ul></ul></div>
<div class="barra" id="premium"><strong>Premium</strong><ul></ul></div>
</div>

<script>
const socket = io("http://localhost:5000");
let token="";
let userData={};

socket.on("barraAtualizada", ({ barra, link }) => {
  const ul=document.querySelector("#"+barra+" ul");
  const li=document.createElement("li");
  li.innerHTML=`<a href="${link}" target="_blank">${link}</a>`;
  ul.appendChild(li);
  if(!userData.barras[barra]) userData.barras[barra]=[];
  userData.barras[barra].push(link);
});

function register(){
  fetch("http://localhost:5000/register",{method:"POST",headers:{"Content-Type":"application/json"},
  body:JSON.stringify({username:document.getElementById("username").value,password:document.getElementById("password").value})})
  .then(r=>r.json()).then(d=>alert(d.message));
}

function login(){
  fetch("http://localhost:5000/login",{method:"POST",headers:{"Content-Type":"application/json"},
  body:JSON.stringify({username:document.getElementById("username").value,password:document.getElementById("password").value})})
  .then(r=>r.json()).then(d=>{
    if(d.success){ token=d.token; userData=d.user; alert("Login ok"); carregarHistorico(); carregarBarras(); }
    else alert(d.message);
  });
}

function responder(){
  const frase=document.getElementById("entrada").value;
  falar(frase);
  fetch("http://localhost:5000/historico",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token,frase})});
  if(userData.historico.length>20) userData.historico.shift();
  userData.historico.push(frase);
  carregarHistorico();
}

function falar(frase){
  const synth=window.speechSynthesis;
  const utter=new SpeechSynthesisUtterance(frase);
  utter.lang="pt-PT";
  synth.speak(utter);
}

function usarFrase(frase){
  document.getElementById("entrada").value=frase;
  responder();
}

function carregarHistorico(){
  const ul=document.getElementById("historico");
  ul.innerHTML="";
  userData.historico.forEach(f=>{const li=document.createElement("li");li.innerText=f;ul.appendChild(li);});
}

function carregarBarras(){
  ["gratuita","intermediaria","premium"].forEach(barra=>{
    const ul=document.querySelector("#"+barra+" ul");
    ul.innerHTML="";
    if(!userData.barras[barra]) userData.barras[barra]=[];
    userData.barras[barra].forEach(link=>{
      const li=document.createElement("li");
      li.innerHTML=`<a href="${link}" target="_blank">${link}</a>`;
      ul.appendChild(li);
    });
  });
}
</script>
</body>
</html>



